<app-component-card title="Fridge">
  <div class="space-y-6">
    <!-- Titre -->
    <h2 class="text-2xl font-bold text-gray-800">Mes produits</h2>

    <!-- Messages -->
    <div *ngIf="loading" class="text-gray-500">Chargement...</div>
    <div *ngIf="errorMessage" class="text-red-500 font-medium">{{ errorMessage }}</div>

    <div *ngIf="!loading && products.length > 0">
      <!-- Filtre -->
      <div class="mb-4 flex items-center gap-2">
        <label for="category" class="font-medium text-gray-700">Filtrer par catégorie:</label>
        <select id="category" [(ngModel)]="selectedCategory" (change)="applyFilter()"
          class="border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="">Toutes</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Liste des produits -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let product of paginatedProducts" [ngClass]="{
               'bg-red-100': product.status === 'expired',
               'bg-yellow-100': product.status === 'soon',
               'bg-white': product.status === 'ok'
             }" class="rounded-xl shadow hover:shadow-lg transition-shadow p-4 flex flex-col items-center text-center">

          <div *ngIf="product.image" class="w-24 h-24 mb-3">
            <img [src]="'http://localhost:3000/uploads/' + product.image" alt="{{ product.name }}"
              class="w-full h-full object-contain rounded-md" />
          </div>

          <h3 class="font-semibold text-lg text-gray-800">{{ product.name }}</h3>
          <p class="text-gray-600 text-sm">Quantité: {{ product.quantity }}</p>
          <p class="text-gray-600 text-sm">Catégorie: {{ product.category }}</p>
          <p class="text-gray-500 text-xs mt-1">Date d’expiration: {{ product.expiryDate | date:'shortDate' }}</p>

          <!-- Badge -->
          <p class="mt-2 font-bold" *ngIf="product.status === 'soon'" style="color: #d97706;">À consommer vite</p>
          <p class="mt-2 font-bold" *ngIf="product.status === 'expired'" style="color: #b91c1c;">Expiré</p>

          <!-- Boutons -->
          <div class="mt-3 flex gap-2">
            <button (click)="markAsUsed(product._id)"
              class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
              Utilisé
            </button>
            <button (click)="deleteProduct(product._id)"
              class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
              Supprimer
            </button>
            <button (click)="suggestForProduct(product.name)"
              class="px-2 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">
              Suggérer des recettes
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center items-center mt-6 space-x-3">
        <button (click)="prevPage()" [disabled]="currentPage === 1"
          class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50">
          Précédent
        </button>
        <span class="text-gray-700 font-medium">Page {{ currentPage }} / {{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="currentPage * itemsPerPage >= filteredProducts.length"
          class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50">
          Suivant
        </button>
      </div>
    </div>

    <div *ngIf="!loading && products.length === 0" class="text-gray-500 font-medium text-center">
      Aucun produit trouvé.
    </div>
  </div>
</app-component-card>